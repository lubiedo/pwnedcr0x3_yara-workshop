CC = gcc
STRIP = strip
CFLAGS += -O3 -Wall -pedantic
STRIPFLAGS = -S --strip-unneeded --remove-section=.note.gnu.gold-version \
	--remove-section=.comment --remove-section=.note \
	--remove-section=.note.gnu.build-id --remove-section=.note.ABI-tag \
	--remove-section=.jcr --remove-section=.got.plt --remove-section=.eh_frame \
	--remove-section=.eh_frame_ptr --remove-section=.eh_frame_hdr
OBJ = dummy dummy_slim

all: dummy slim evil_section

.PHONY: slim evil_section clean
slim:
	$(CC) $(CFLAGS) -DNOSTRINGS -o dummy_slim dummy.c
	$(STRIP) $(STRIPFLAGS) dummy_slim

evil_section:
	echo "death to COVID-19" > section && \
		objcopy --add-section .evil_section=section dummy

clean:
	rm -f $(OBJ) section
